{% extends 'base.html' %}
{% load static %}

{% block title %}게임 전적{% endblock %}

{% block content %}
<div class="game-history">
    <h2 class="game-history__title">🃏 {{ user.username }}의 게임 전적 🃏</h2>

    <h3 class="game-history__subtitle">⚔️ 나의 공격 ⚔️</h3>
    <ul class="game-list">
    {% for game in attacks %}
        <li class="game-item">
            <div class="game-item__info">
                <span class="game-item__opponent">vs {{ game.defender.username }}</span> - 
                <span class="game-item__status">
                {% if game.status == 'PENDING' %}
                    진행중... 
                    <form class="game-item__cancel-form" action="{% url 'game:cancel_game' game.id %}" method="post">
                        {% csrf_token %}
                        <button class="btn btn--cancel" type="submit">취소하기</button>
                    </form>
                {% elif game.status == 'ONGOING' %}
                    게임 진행 중
                {% elif game.status == 'FINISHED' %}
                    <span class="game-item__result {% if game.result == 'ATTACKER_WIN' %}game-item__result--win{% elif game.result == 'DEFENDER_WIN' %}game-item__result--lose{% else %}game-item__result--draw{% endif %}">
                    {% if game.result == 'ATTACKER_WIN' %}
                        승리
                    {% elif game.result == 'DEFENDER_WIN' %}
                        패배
                    {% else %}
                        무승부
                    {% endif %}
                    </span>
                {% elif game.status == 'CANCELLED' %}
                    취소됨
                {% endif %}
                </span>
            </div>
            <a class="btn btn--detail" href="{% url 'game:game_detail' game.id %}">게임 정보</a>
        </li>
    {% endfor %}
    </ul>

    <h3 class="game-history__subtitle">🛡️ 나의 방어 🛡️</h3>
    <ul class="game-list">
    {% for game in defenses %}
        <li class="game-item">
            <div class="game-item__info">
                <span class="game-item__opponent">vs {{ game.attacker.username }}</span> - 
                <span class="game-item__status">
                {% if game.status == 'PENDING' %}
                    공격받는 중입니다! <a class="btn btn--counter" href="{% url 'game:counter_attack' game.id %}">반격하기</a>
                {% elif game.status == 'ONGOING' %}
                    게임 진행 중
                {% elif game.status == 'FINISHED' %}
                    <span class="game-item__result {% if game.result == 'DEFENDER_WIN' %}game-item__result--win{% elif game.result == 'ATTACKER_WIN' %}game-item__result--lose{% else %}game-item__result--draw{% endif %}">
                    {% if game.result == 'DEFENDER_WIN' %}
                        승리
                    {% elif game.result == 'ATTACKER_WIN' %}
                        패배
                    {% else %}
                        무승부
                    {% endif %}
                    </span>
                {% elif game.status == 'CANCELLED' %}
                    취소됨
                {% endif %}
                </span>
            </div>
            <a class="btn btn--detail" href="{% url 'game:game_detail' game.id %}">게임 정보</a>
        </li>
    {% endfor %}
    </ul>
</div>
{% endblock %}